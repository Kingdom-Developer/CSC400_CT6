/* 
 Custom linked list class that inserts at the tail and removes from the head
*/

CLASS CustomLinkedList
    DECLARE PRIVATE Node head
    DECLARE PRIVATE Node tail
    
     
    /*
     * Default constructor to create empty CustomLinkedList
     */
    CONSTRUCTOR CustomLinkedList
        THIS.head = NULL
        THIS.tail = NULL
    END CONSTRUCTOR

    /*
     * Inserts a new node with the given data
     */
    METHOD insert(int data)
        // Create new Node with the data passed as an argument
        DECLARE newNode = NEW Node(data)

        IF head EQUALS NULL THEN
            // Set newNode as the head and tail node
            head = newNode
            tail = newNode
        ELSE
            // Insert new node at the end of the list
            tail.next = newNode
            tail = newNode
        END IF
    END METHOD

    /*
     * Deletes the first occurrence of a node with the given data
     */
    METHOD delete(int data)
        // Check if the list is empty
        IF head EQUALS NULL THEN
            RETURN
        END IF
    
        IF head.data EQUALS data THEN
            head = head.next
      
            // Check if list is now empty and set tail to null if it is
            IF head EQUALS NULL THEN
                tail = NULL
            END IF
            RETURN
        END IF

        DECLARE currentNode = head
       
        // Traverse through list to check if any Node's data matches the input data and if so, remove the Node
        WHILE currentNode.next DOES NOT EQUAL NULL DO
            // Check if currentNode's next Node's data matches
            IF currentNode.next.data EQUALS data THEN
                // Remove currentNode's next Node
                currentNode.next = currentNode.next.next

                // Check if the removed Node was the tail
                IF currentNode.next EQUALS NULL THEN
                    tail = currentNode
                END IF
                RETURN
            END IF
            
            // Move to next Node in list
            currentNode = currentNode.next
        END WHILE

        // When method reaches this point, print that the value was not found
        OUTPUT "Unable to delete '" + data + "', value not found." + NEWLINE
    END METHOD

    /*
     * Creates an iterator for traversing the linked list
     */
    METHOD Iterator of Integer iterator()
        RETURN NEW LinkedListIterator
    END METHOD

    /*
     * Node class to be used by CustomLinkedList
     */
    PRIVATE CLASS Node
        DECLARE int data
        DECLARE Node next
    
        /*
         * Parameterized constructor for Node
         */
        CONSTRUCTOR Node(int data)
            THIS.data = data
            THIS.next = NULL
        END CONSTRUCTOR
    END CLASS

    /*
     * Implements a iterator object for the CustomLinkedList
     */
    PRIVATE CLASS LinkedListIterator IMPLEMENTS Iterator of Integer
        DECLARE PRIVATE Node current = head
        
        /*
         * Override hasNext method for LinkedListIterator
         */
        METHOD Boolean hasNext()
            RETURN current IS NOT NULL
        END METHOD

        /*
         * Override next method for LinkedListIterator
         */
        METHOD Integer next()
            IF NOT CALL hasNext() THEN
                THROW EXCEPTION NoSuchElementException
            END IF
            
            DECLARE int data = current.data
            current = current.next
            RETURN data
        END METHOD
    END CLASS

    /*
     * Reads integer data from a file and stores each integer as a Node in the CustomLinkedList
     */
    METHOD readFromFile(String filename)
        // Attempt to open the file
        TRY
            DECLARE FILE file = NEW File(filename)
            DECLARE SCANNER scnr = NEW Scanner(file)
            
            // Read each integer and store into list
            WHILE CALL scnr.hasNext() DO
                // Check if next token is an integer
                IF CALL scnr.hasNextInt() THEN
                    CALL THIS.insert(CALL scnr.nextInt())
                // Skip next token
                ELSE
                    CALL scnr.next()
                END IF
            END WHILE
        // Handle potential exception from opening the file
        CATCH FileNotFoundException e
            OUTPUT "Invalid file name: " + filename + NEWLINE
        END TRY
    END METHOD
END CLASS

/*
 * Program that utilizes the CustomLinkedList and performs inserting single values
 * and multiple values that are read from file, deleting values, and creates iterator
 * object to iterate through the linked list.
 */
CLASS Main
    MAIN METHOD
        // Initiate new CustomLinkedList
        DECLARE CustomLinkedList linkedList = NEW CustomLinkedList

        // Insert some elements
        CALL linkedList.insert(1)
        CALL linkedList.insert(2)
        CALL linkedList.insert(3)

        // Delete some elements
        CALL linkedList.delete(2);
        CALL linkedList.delete(1);
        
        // Attempt to delete element that doesn't exist in list
        CALL linkedList.delete(34);

        // Test the readFromFile method
        CALL linkedList.readFromFile("data.txt")

        // Create iterator object for the CustomLinkedList
        DECLARE Iterator of Integer iterator = CALL linkedListIterator()

        // Iterate and display elements
        WHILE CALL iterator.hasNext() DO
            OUTPUT CALL iterator.next() + " "
        END WHILE
    END METHOD
END CLASS